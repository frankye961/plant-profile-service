server:
  port: 8086

spring:
  application:
    name: plant-profile-service

  autoconfigure:
    exclude:
      - org.springframework.boot.mongodb.autoconfigure.MongoAutoConfiguration
      - org.springframework.boot.data.mongodb.autoconfigure.DataMongoAutoConfiguration

  mongodb:
    uri: ${SPRING_MONGODB_URI}

  kafka:
    producer:
      key-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      value-serializer: org.springframework.kafka.support.serializer.StringOrBytesSerializer

  main:
    web-application-type: reactive

  cloud:
    function:
      definition: ingestTelemetryData

    stream:
      default-binder: kafka

      bindings:
        ingestTelemetryData-in-0:
          destination: iot.plant.events.raw
          group: telemetry-data
        ingestTelemetryData-out-0:
          destination: iot.plant.profile.events
          group: plant-data

      kafka:
        binder:
          bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS:kafka:9092}
          producer:
            key-serializer: org.springframework.kafka.support.serializer.JsonSerializer
            value-serializer: org.springframework.kafka.support.serializer.StringOrBytesSerializer
            properties:
              acks: all
              enable.idempotence: true
              max.in.flight.requests.per.connection: 5
              retries: 10
          auto-create-topics: true
          configuration:
            acks: all
            linger.ms: 5

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env
  endpoint:
    health:
      show-details: always

logging:
  level:
    root: INFO
    org.springframework.cloud.stream: INFO
    reactor.kafka: WARN
