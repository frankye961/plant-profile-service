openapi: 3.0.3
info:
  title: IoT Plant Event
  version: 1.0.0
  description: >
    Schema for events produced by the telemetry bridge (MQTT -> Kafka) and consumed by internal services.

paths: {}  # event contract only (no REST endpoints required)

components:
  schemas:

    # -------------------------
    # Root event
    # -------------------------
    IoTPlantEvent:
      type: object
      required:
        - type
        - version
        - messageId
        - ts
        - device
        - zone
      additionalProperties: false
      properties:
        type:
          type: string
          description: Event type discriminator.
          enum: [IOT_PLANT_EVENT]
        version:
          type: integer
          format: int32
          description: Event schema version.
          minimum: 1
        messageId:
          type: string
          description: Unique message id for idempotency and tracing.
          example: 05fe5f23-700e-eaec-6314-cec56129d6c7
        correlationId:
          type: string
          nullable: true
          description: Correlation id for distributed tracing.
        ts:
          type: string
          format: date-time
          description: Event timestamp in ISO-8601.
          example: "1970-01-01T00:00:43.751Z"
        device:
          $ref: "#/components/schemas/DeviceMeta"
        zone:
          $ref: "#/components/schemas/Zone"

    # -------------------------
    # Device section
    # -------------------------
    DeviceMeta:
      type: object
      required:
        - deviceId
        - deviceName
        - model
        - fw
        - batteryMv
        - rssi
      additionalProperties: false
      properties:
        deviceId:
          type: string
          description: Device unique id (provided by device firmware).
          example: b43a45349704
          minLength: 1
          maxLength: 128
        deviceName:
          type: string
          description: Human-friendly name set in firmware.
          example: Balcony Arduino
          minLength: 1
          maxLength: 256
        model:
          type: string
          example: Arduino UNO R4 WiFi
          minLength: 1
          maxLength: 128
        fw:
          type: string
          description: Firmware version string.
          example: 1.0.3
          minLength: 1
          maxLength: 64
        batteryMv:
          type: integer
          format: int32
          nullable: true
          description: Battery voltage in millivolts.
          minimum: 0
          maximum: 20000
          example: 4914
        rssi:
          type: integer
          format: int32
          nullable: true
          description: WiFi RSSI in dBm.
          minimum: -150
          maximum: 0
          example: -66

    # -------------------------
    # Zone section
    # -------------------------
    Zone:
      type: object
      required:
        - zoneId
        - zoneName
        - sensor
      additionalProperties: false
      properties:
        zoneId:
          type: string
          description: Logical zone identifier.
          example: pot-03
          minLength: 1
          maxLength: 128
        zoneName:
          type: string
          description: Human-friendly zone name.
          example: Basil pot
          minLength: 1
          maxLength: 256
        sensor:
          $ref: "#/components/schemas/SensorReading"

    # -------------------------
    # Sensor reading
    # -------------------------
    SensorReading:
      type: object
      required:
        - type
      additionalProperties: false
      properties:
        type:
          type: string
          description: Sensor type discriminator (keep flexible for future).
          example: MOCK
          minLength: 1
          maxLength: 64

        soilMoistureRaw:
          type: integer
          format: int32
          nullable: true
          description: Raw ADC reading from soil moisture sensor.
          minimum: 0
          maximum: 4095
          example: 588

        soilMoisturePct:
          type: number
          format: float
          nullable: true
          description: Soil moisture percentage (0-100).
          minimum: 0
          maximum: 100
          example: 52

        lightRaw:
          type: integer
          format: int32
          nullable: true
          description: Raw light sensor reading.
          minimum: 0
          maximum: 4095
          example: 312

        tempC:
          type: number
          format: float
          nullable: true
          description: Temperature in Celsius.
          minimum: -50
          maximum: 120
          example: 21.59775
